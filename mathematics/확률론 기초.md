# 확률론 기초

- **목차**
  
  1. [확률의 단순한 정의와 이항계수](#1-확률의-단순한-정의와-이항계수)
  2. [확률의 성질](#2-확률의-성질)
     - 확률의 성질 2가지
     - 확률의 속성들
     - Birthday problem
  3. [조건부 확률](#3-조건부-확률)
     - 독립
     - 조건부 확률
     - 전체 확률의 법칙
     - 베이즈 정리
     - Monty Hall problem ( 수형도, 전체 확률의 법칙 풀이)
     - 심슨의 역설 (Simpson's Paradox)
  4. [확률변수](#4-확률변수-(random-variable))
     - 도박꾼의 파산 (Gambler's ruin)

# 1. 확률의 단순한 정의와 이항계수

- **용어 정리**

  - **표본 공간 (S, sample space)** : 어떤 시행에서 일어날 수 있는 모든 결과들의 모임

  - **사건 (event)** : 표본공간 (sample space)의 부분집합으로 어떤 조건을 만족하는 특정한 표본점들의 집합

    

- **확률의 단순한 정의 (Naive definition)**

  P(A)로 표기하며 ( 가능한 A의 결과의 수 ) / (가능한 모든 경우의 수)를 의미한다.

  - 확률의 분모는 유한한 값을 가져야 한다.

  - 단순한 정의로 해결할 수 있는 문제는 확률이 동일한 경우에만 해당한다.

    ex) 해왕성에 생물이 살 확률은? -> 단순한 정의에 의하면 산다/안산다 이므로 50%이다.

    50%의 확률은 말도 안되는 값임을 알 수 있다. 

    ex2) 해왕성에 지능을 가진 생물이 살 확률은 ? -> 마찬가지로 50%이다. 직관적으로 생각해봐도 생물이 살 확률보다 지능을 가진 생물이 살 확률이 훨씬 낮아야하지만 그렇지 않기에 문제가 된다.



- **이항계수 (Binomial Coeffecient)**

  자연수 n 및 정수 k가 주어졌을 때 **nCk** 또는 **C(n,k)** 로 표기한다.

  수식으로 나타내면 
  ![image](https://user-images.githubusercontent.com/71866756/147647425-56ac7a9c-61ec-4232-8bcd-45319eee6e7a.png)

  - 이항계수의 3가지 성질

    - C(n, k) = C(n, n-k) (이항계수의 정의를 이용해 증명 가능)

    - nC(n-1, k-1) = k(n, k)

      증명) n명의 사람들 중 k명을 뽑고, 그 중 한명을 대표로 뽑는 경우를 생각할 수 있다. 

      ​		  (좌변) 대표를 먼저 뽑는 경우 : n명 중 1명 (n), n-1명 중 k-1명 ( C(n-1, k-1) )

      ​          (우변) k명을 먼저 뽑는 경우 : n명 중 k명 ( C(n, k) ), k명 중 1명 (k) 

    ![image](https://user-images.githubusercontent.com/71866756/147647465-25b2cc70-eaad-4c8a-ada3-82082c1039da.png)


  **!! 주의할 점 !!**

  10명 중 4명, 6명으로 두팀을 만든다고 하였을 때의 확률은 10C6=10C4이다.

  하지만, 10명 중 5명, 5명으로 두팀을 만든다고 하였을 때의 확률은 10C5 / 2가 된다.

  ( 두 팀을 완벽히 구분이 가능하다면 2로 나누지 않아도 되지만, 구분이 불가능할 경우 중복으로 counting이 되기 때문에 2로 나눠줘야 한다. )

  

  |                        | 순서상관있는 경우 | 순서상관없는 경우 |
  | ---------------------- | ----------------- | ----------------- |
  | **복원하는 경우**      | n^k               | n+k-1Ck           |
  | **복원하지 않는 경우** | nPk               | nCk               |

  - 순서상관없고, 복원하는 경우의 n+k-1Ck 증명

    ![image](https://user-images.githubusercontent.com/71866756/147635035-0e217ff2-4ec0-45f3-829b-c29895dcfa20.png)




# 2. 확률의 성질

- **확률의 성질 2가지**

  - 표본 공간 S, S의 사건 A를 입력으로 받았을 때, 0~1 사이의 값을 출력으로 갖는 함수 P가 있다고 했을 때, 만족하는 성질 2가지
  
  ![image](https://user-images.githubusercontent.com/71866756/147647362-3e1f6d3c-67e4-4fbe-9e80-e8181c5abfc8.png)
  
  
  
- **확률의 성질로 증명할 수 있는 속성들**

  - 공집합의 확률  
    ![image](https://user-images.githubusercontent.com/71866756/147647495-434be893-6920-460b-aa3b-1e0272e493d3.png)
  
  
  
- **여집합의 확률**  
    ![image](https://user-images.githubusercontent.com/71866756/147647507-c6d75e96-03d6-4c86-969a-5d83c221a881.png)
    
  - 포함 배제의 원리  
    ![image](https://user-images.githubusercontent.com/71866756/147647528-91d6125e-406a-40a7-a9a8-e1c798f2d966.png)
    - 증명  
    ![image](https://user-images.githubusercontent.com/71866756/147647546-b2a93ebb-ebca-450b-aa4c-362a0fe91f2d.png)
  
  
  
- **Birthday Problem**

  k명의 사람들 중 적어도 2명의 생일이 같은 확률이 50%가 넘는 k의 값은?

  ( 365일 중 태어날 확률은 모두 equally likely라고 가정하면 단순한 정의를 이용할 수 있다. )

  - k > 365일 경우

    **비둘기집의 원리**로 k>365보다 크면 적어도 한 쌍은 생일이 같을 수 밖에 없다. 

  - k <= 365일 경우

    : 직관적으로 생각해보면 365일 중 생일이 같은 확률은 크다고 생각되지 않는다. 하지만 이 문제의 정답은 23명이다. 

    P(생일이 모두 다를 경우) = ( 365x364x...x(365-k+1) ) / ( 365^k ) 으로 나타낼 수 있다. 

    P( 생일이 적어도 한명 같은 경우 ) = 1 - P(생일이 모두 다를 경우) 가 된다. 

    따라서 **k=23일 경우 확률은 약 50.7%**, **k=100일 경우 약 99.999%**가 나온다.

    -> 이 문제를 조금 다른 시각으로 보면 k=23일 때, 23C2로 생일이 같은 경우의 조합의 수를 생각해볼 수 있다. 23C2 = 253으로 상당히 많은 경우의 수가 나올 수 있다. 이러한 시각으로 봤을 때, 두명의 생일이 같을 확률은 꽤 크다고 볼 수 있다.

     ```c++
     // 실제 코드로 작성하여 난수 생성하여 실험해본 결과 50%에 육박하게 나오는 것을 확인할 수 있었다. 
     #include <iostream>
     #include <cstdlib>
     #include <map>
     #include <ctime>
     using namespace std;
     
     int main() {
     	int cnt = 0;
     	srand((unsigned int)time(NULL));
     	for (int k = 0; k < 10; k++) {
     		for (int j = 0; j < 1000; j++) {
     			map<int, int> m;
     			for (int i = 0; i < 23; i++) {
     				int temp = rand() % 365 + 1;
     				if (m[temp] != 0) {
     					m[temp] += 1;
     					cnt++;
     					break;
     				}
     				else m[temp] = 1;
     			}
     		}
     		cout << k+1 << "번째 확률 : " << (double)cnt / (double)1000 << endl;
     		cnt = 0;
     	}
     }
     ```

     ![image](https://user-images.githubusercontent.com/71866756/147647720-edcfb2e0-c2b3-4cab-93c0-00d91fe0fb5a.png)

# 3. 조건부 확률

- **독립**

  사건 A,B는 P(A,B)=P(A)P(B)일 경우, 독립이라고 한다. 

  

- **조건부 확률**

  사건 B가 발생했을 때 A가 발생할 확률로 만약 A와 B가 독립이 아닌 경우 매우 유용하다. 

  **!!! 중요 !!!** 

  여기서 P(B)로 나눠주는 이유는 B를 이미 발생한 사건으로 보고 A가 발생할 확률을 구하는 것이기 때문에 전체 표본 공간이었던 S가 B로 축소되고 이를 정규화하기 위해 P(B)로 나누어주는 것이다.   
  ![image](https://user-images.githubusercontent.com/71866756/148025973-9d076724-c5b6-43a0-a0d6-016fc3a20441.png)

   

  A와 B가 독립인 경우는 아래 수식으로 나타낼 수 있다.  
  ![image](https://user-images.githubusercontent.com/71866756/148026015-d4f72e20-3aad-44a9-bf8e-c023a9ca0c8f.png)

  - 정리

    ![image](https://user-images.githubusercontent.com/71866756/148026040-7f09ce2d-b65e-4b3f-bde4-5023e196827e.png)
    
    

- **전체 확률의 법칙 (law of total probability)**

  어려운 문제를 간단하게 쪼개어 해결하는 방법 중에 하나로 생각할 수 있다. 

  _**조건부 확률**_로부터 _**조건이 붙지 않은 확률**_을 계산할 때 사용할 수 있다.  

  (즉, P(B)를 B와 A의 조건부 확률로부터 계산 가능)

  <img src="../../../../AppData/Roaming/Typora/typora-user-images/image-20220104165959372.png" alt="image-20220104165959372" style="zoom:67%;" />
  $$
  \begin{aligned} P(B)&=P(B\cap A)\\
  &=P(B\cap A_1)+P(B\cap A_2)\\
  &=P(B|A_1)P(A_1)+P(B|A_2)P(A_2)\end{aligned}
  $$

- **베이즈 정리**
  $$
  P(A|B)= \frac{P(B|A)P(A)}{P(B)}
  $$

  - 사전 확률 (P(A), prior) : 주어진 확률

  - 사후 확률 (P(A|B), posterior) : 구하는 확률

  - 조건부 독립 (conditional independence) : 사건 A,B가 사건 C가 주어졌을 경우 독립인 상황
    $$
    P(A,B|C)=P(A|C)P(B|C)\quad (독립과는\space  다르다)
    $$

  **!!! 주의 !!!**

   조건부 독립과 독립은 별개이다. 독립이라고 해서 무조건 조건부 독립이 아니고, 조건부 독립이라고 해서 무조건 독립인 것도 아니다. 

  

  **EX)** 질병이 걸릴 확률은 1%이고 test가 정확한 확률은 95%일 때, 실제 질병에 걸렸을 확률은?

  P(D) : 질병에 걸렸을 확률

  P(T) : 테스트 결과 질병에 걸렸을 확률

  P(T|D) = 0.95
  $$
  \begin{aligned}P(D|T)&=\frac {P(T|D)P(D)}{P(T)}\\
  &=\frac {P(T|D)P(D)}{P(T,D)P(T,D^c)}\\
  &=\frac {P(T|D)P(D)}{P(T|D)P(D)+P(T|D^c)P(D^c)}\\
  &\approx 0.16
  \end{aligned}
  $$
  => 실제 질병에 걸렸을 확률은 0.16으로 매우 낮은 값을 보인다. 

  => 직관적으로는 test 정확도가 높기 때문에 test결과 질병에 걸렸다고 나왔을 경우, 실제 질병에 걸렸을 확률은 더욱 높을 것으로 예상하지만 _**직관과는 정반대의 결과**_를 보인다.

  => 이는 test 정확도에 치중하여 생각하기 때문이다. 실제로 _**병의 발생확률도 고려**_해야 하기 때문에 이와 같은 결과를 보이는 것이다. 



- **Monty Hall 문제**

  - 수형도를 이용하여 풀이한 경우

    <img src="../../../../AppData/Roaming/Typora/typora-user-images/image-20220104184015678.png" alt="image-20220104184015678" style="zoom:67%;" />

    

  - 전체 확률의 법칙을 이용한 경우

    S : 차를 뽑는 경우 (가정은 항상 선택을 바꾼다.)

    Dj : j번 문 뒤에 차가 있는 경우

    !! 처음에 1번 문을 선택한다고 가정하자 !!
    $$
    \begin{aligned}
    P(S)&=P(S|D_1)P(D_1)+P(S|D_2)P(D_2)+P(S|D_3)P(D_3)\\
    &=P(S|D_1)\frac{1}{3}+P(S|D_2)\frac{1}{3}+P(S|D_3)\frac{1}{3}\\
    &=0*\frac{1}{3}+1*\frac{1}{3}+1*\frac{1}{3}\\
    &(1번\space문뒤에\space차가\space있지만\space선택을\space바꿈으로 \space0,\\ 
    &\space나머지는\space선택을\space바꿔서\space항상\space정답이므로 1)\\
    &=\frac{2}{3}
    \end{aligned}
    $$



- **심슨의 역설 (Simpson's Paradox)**

  개별적인 항목에서 항상 뛰어난 결과여도 항목들의 합에서는 반대의 결과가 나타난다는 paradox

  | Person1  | 심장 수술 | 붕대풀기 | Person2  | 심장 수술 | 붕대풀기 |
  | -------- | --------- | -------- | -------- | --------- | -------- |
  | **성공** | 70        | 10       | **성공** | 2         | 81       |
  | **실패** | 20        | 0        | **실패** | 8         | 9        |

  - 위 케이스를 살펴보면 Person1의 각각의 항목의 성공률이 Person2보다 높은 것을 알 수 있다.

    ( 조건부 ) 

  - 하지만 전체 항목의 합은 Person1은 80%, Person2는 83%로 Person2가 높은 것을 알 수 있다. 

    ( 비조건부 )

  - A : surgery succeed, B : Person2이 수술, C : 심장 수술

    수식으로 표현하자면 아래처럼 될 것이다. 
    $$
    P(A|B, C)<P(A|B^C,C)\\
    P(A|B, C^c)<P(A|B^C,C^c)\\
    P(A|B)>P(A|B^c)
    $$

  - 이것이 심슨의 역설이다. 이것이 잘못된 이유는 아래 식으로 볼 수 있다. 
    $$
    P(A|B)=P(A|B,C)P(C|B)+P(A|B,C^c)P(C^c|B)
    $$
    여기서 P(C|B)와 P(C^c|B)는 가중치라고 생각할 수 있는데, Person2가 해당 수술을 얼마나 진행했는지 나타내는 확률이다. 이 값이 들어간다면 심슨의 역설은 성립하지 않게 된다. 이것이 심슨의 역설이 존재할 수 있게 만드는 이유이다.  

  _**!!! 따라서 교란 요인 (위 예에서는 C) 을 고려하는 것이 매우 중요하다 !!!**_



# 4. 확률변수 (Random Variable)

- **확률 변수란**

   확률 변수는 표본 공간에서 실수로 가는 함수이다. 간단하게 말하자면 임의의 확률 시행의 수치적인 "요약"이라고 할 수 있다. 꼭 전체 표본공간의 요약일 필요는 없다. 확률변수를 사용하는 이유는 다루기 어려운 표본 공간에서 다루기 쉬운 실수로 대응할 수 있기 때문이다. 

- **도박꾼의 파산 (Gambler's Ruin)**

  A와 B 두명의 도박꾼이 매 라운드 $1씩 걸고 도박을 한다. 이긴 사람은 상대방의 $1을 가져가고, 둘 중 한명이 가지고 온 돈이 바닥날 때까지 이 과정을 반복한다. 

  p = P(A가 어떤 라운드를 이긴다.)

  q = 1-p

  A는 i달러, B는 N-i 달러를 가지고 게임을 한다고 할 때, 
  $$
  p_i = A가\space i달러로\space 시작하여\space 전체게임을\space 이길\space 확률\\
  p_0 = 0, \space p_N=1이다.\\
  p_i = p*p_{i+1} + q*p_{i-1}
  $$
  _위 수식을 계차방정식이라고 한다. 미분 방정식의 discrete형태를 의미한다._ 

  - 계차방정식의 풀이

    <img src="../../../../AppData/Roaming/Typora/typora-user-images/image-20220104195538893.png" alt="image-20220104195538893" style="zoom:67%;" />



- **베르누이 분포 ( p, Bernoulli )**

  X가 0(실패), 1(성공) 두가지의 값만 가질 수 있으며, 

  **P(x=1)=p, P(x=0)=1-p**일 때, X는 _Bernoulli(p)_분포를 따른다고 한다.  

  시행전의 x는 무엇인지 모르지만, 시행 후에는 0 또는 1이 된다. 



- **이항분포 ( (n,p), Binomial )**

  n번의 독립적인 베르누이(p) 시행에서 성공 횟수의 분포는 _Bin(n,p)_를 따른다고 한다. 

  - 확률질량함수 (PMF, probability mass function)
    $$
    P(x=k)=C(n,k)p^k(1-p)^{n-k}
    $$

  - **_X~Bin(n,p), Y~Bin(m,p)_**이면서 X와 Y가 **독립**일 경우, **_X+Y~Bin(n+m,p)_**이다. 

  

